; PlatformIO Configuration for ESP32 Evil Portal
; Builds both Standalone and Flipper editions
;
; Commands:
;   pio run -e standalone    # Build standalone only
;   pio run -e flipper       # Build flipper only
;   pio run                  # Build both (default)

[platformio]
default_envs = standalone, flipper

; ========================================
; COMMON SETTINGS
; ========================================
[env]
platform = espressif32@6.5.0
board = esp32-s3-devkitc-1
framework = arduino
monitor_speed = 115200
upload_speed = 921600

; Partition table with SPIFFS
board_build.partitions = partitions_evilportal.csv

; USB CDC for serial output
build_flags = 
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1

; Required libraries (Core 3.x compatible)
lib_deps = 
    mathieucarbou/AsyncTCP@^3.2.14
    mathieucarbou/ESPAsyncWebServer@^3.3.23
    bblanchon/ArduinoJson@^7.2.1

; ========================================
; STANDALONE EDITION
; ========================================
[env:standalone]
; Only compile main.cpp (existing standalone firmware)
build_src_filter = 
    +<*>
    -<main_flipper.cpp>

build_flags = 
    ${env.build_flags}
    -DFIRMWARE_EDITION=\"standalone\"

; Output filename

; ========================================
; FLIPPER EDITION
; ========================================
[env:flipper]
; Only compile main_flipper.cpp
build_src_filter = 
    +<*>
    -<main.cpp>

build_flags = 
    ${env.build_flags}
    -DFIRMWARE_EDITION=\"flipper\"

; Output filename
